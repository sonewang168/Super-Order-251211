<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a0f">
    <title>ğŸ¨ è¶…ç´šæŒ‡ä»¤æ’ç•«ç”Ÿæˆå™¨ Pro v1.0</title>
    
    <!-- Google API -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&family=Orbitron:wght@400;700;900&display=swap');
        
        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #12121a;
            --bg-card-hover: #1a1a25;
            --bg-input: #0d0d14;
            --cyan: #00f5ff;
            --cyan-glow: rgba(0, 245, 255, 0.3);
            --purple: #a855f7;
            --purple-glow: rgba(168, 85, 247, 0.3);
            --pink: #ff00ff;
            --pink-glow: rgba(255, 0, 255, 0.2);
            --gold: #ffd700;
            --gold-glow: rgba(255, 215, 0, 0.3);
            --emerald: #00ff88;
            --emerald-glow: rgba(0, 255, 136, 0.3);
            --orange: #ff8800;
            --red: #ff3366;
            --text-light: #e2e8f0;
            --text-dim: #94a3b8;
            --text-muted: #64748b;
            --border: #2a2a3a;
            --nav-height: 70px;
            --header-height: 56px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        html, body { height: 100%; overflow: hidden; touch-action: manipulation; }
        body { font-family: 'Noto Sans TC', sans-serif; background: var(--bg-dark); color: var(--text-light); line-height: 1.6; }

        /* ========== é–‹æ©Ÿå‹•ç•« ========== */
        /* ========== é–‹æ©Ÿå‹•ç•« - ç§‘æŠ€å†·å…‰é¢¨æ ¼ ========== */
        .splash-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #050508 0%, #0a0a12 50%, #050508 100%);
            display: flex; align-items: center; justify-content: center; z-index: 9999;
            transition: opacity 0.8s ease, transform 0.8s ease; overflow: hidden;
        }
        .splash-screen::before {
            content: ''; position: absolute; inset: 0;
            background: 
                radial-gradient(ellipse at 50% 0%, rgba(0, 245, 255, 0.08) 0%, transparent 50%),
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 245, 255, 0.02) 2px, rgba(0, 245, 255, 0.02) 4px);
            pointer-events: none;
        }
        .splash-screen.fade-out { opacity: 0; transform: scale(1.1); pointer-events: none; }
        .splash-content { text-align: center; position: relative; z-index: 1; }
        
        /* è¶…å­—å®¹å™¨ */
        .splash-icon-wrap { position: relative; width: 150px; height: 150px; margin: 0 auto 24px; }
        
        /* æ—‹è½‰å…‰ç’° */
        .splash-ring { position: absolute; inset: 0; border: 2px solid transparent; border-radius: 50%; }
        .splash-ring-1 { border-top-color: var(--cyan); border-right-color: rgba(0,245,255,0.2); animation: ringSpin 2s linear infinite; box-shadow: 0 0 20px rgba(0,245,255,0.3); }
        .splash-ring-2 { inset: 12px; border-top-color: var(--purple); border-left-color: rgba(168,85,247,0.2); animation: ringSpin 2.5s linear infinite reverse; box-shadow: 0 0 15px rgba(168,85,247,0.3); }
        .splash-ring-3 { inset: 24px; border-bottom-color: var(--pink); border-right-color: rgba(255,0,255,0.2); animation: ringSpin 3s linear infinite; box-shadow: 0 0 10px rgba(255,0,255,0.3); }
        @keyframes ringSpin { to { transform: rotate(360deg); } }
        
        /* è¶…å­—æ ¸å¿ƒ */
        .splash-icon {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 58px; font-weight: 900; font-family: 'Microsoft YaHei', sans-serif;
            color: transparent;
            background: linear-gradient(135deg, #00f5ff 0%, #a855f7 50%, #00f5ff 100%);
            background-size: 200% 200%;
            -webkit-background-clip: text; background-clip: text;
            animation: textShine 2s linear infinite, textPulse 3s ease-in-out infinite;
            filter: drop-shadow(0 0 25px rgba(0,245,255,0.9)) drop-shadow(0 0 50px rgba(0,245,255,0.4));
        }
        @keyframes textShine { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        @keyframes textPulse { 0%,100% { filter: drop-shadow(0 0 25px rgba(0,245,255,0.9)) drop-shadow(0 0 50px rgba(0,245,255,0.4)); } 50% { filter: drop-shadow(0 0 35px rgba(168,85,247,1)) drop-shadow(0 0 70px rgba(168,85,247,0.5)); } }
        
        /* æƒæç·š */
        .splash-scan { position: absolute; inset: 0; border-radius: 50%; overflow: hidden; }
        .splash-scan::after { content: ''; position: absolute; inset: 0; background: linear-gradient(180deg, transparent 40%, rgba(0,245,255,0.15) 50%, transparent 60%); animation: scanMove 2s linear infinite; }
        @keyframes scanMove { 0% { transform: translateY(-100%); } 100% { transform: translateY(100%); } }
        
        /* ç²’å­ */
        .splash-dots { position: absolute; inset: 0; }
        .splash-dot { position: absolute; width: 4px; height: 4px; background: var(--cyan); border-radius: 50%; animation: dotPulse 2s ease-in-out infinite; }
        .splash-dot:nth-child(1) { top: 0; left: 50%; transform: translateX(-50%); }
        .splash-dot:nth-child(2) { top: 50%; right: 0; transform: translateY(-50%); animation-delay: 0.5s; background: var(--purple); }
        .splash-dot:nth-child(3) { bottom: 0; left: 50%; transform: translateX(-50%); animation-delay: 1s; }
        .splash-dot:nth-child(4) { top: 50%; left: 0; transform: translateY(-50%); animation-delay: 1.5s; background: var(--purple); }
        @keyframes dotPulse { 0%,100% { opacity: 0.3; transform: translateX(-50%) scale(1); } 50% { opacity: 1; transform: translateX(-50%) scale(1.8); } }
        
        .splash-title { font-family: 'Orbitron', sans-serif; font-size: 22px; font-weight: 900; background: linear-gradient(90deg, var(--cyan), var(--purple), var(--cyan)); background-size: 200% 100%; -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 8px; animation: titleShine 3s linear infinite; }
        @keyframes titleShine { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .splash-subtitle { font-size: 12px; color: var(--cyan); letter-spacing: 3px; opacity: 0.8; }
        .splash-progress { width: 180px; height: 2px; background: rgba(0,245,255,0.1); border-radius: 2px; margin: 28px auto 0; overflow: hidden; border: 1px solid rgba(0,245,255,0.2); }
        .splash-progress-bar { height: 100%; width: 0; background: linear-gradient(90deg, var(--cyan), var(--purple), var(--cyan)); box-shadow: 0 0 10px var(--cyan); animation: progressLoad 2.5s ease forwards; }
        @keyframes progressLoad { 0% { width: 0; } 100% { width: 100%; } }

        /* ========== APP å®¹å™¨ ========== */
        .app-container { height: 100%; display: flex; flex-direction: column; padding-top: env(safe-area-inset-top); padding-bottom: env(safe-area-inset-bottom); }

        /* ========== é ‚éƒ¨æ¨™é¡Œ ========== */
        .app-header { height: var(--header-height); background: linear-gradient(135deg, rgba(0, 245, 255, 0.08), rgba(168, 85, 247, 0.08)); border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 16px; flex-shrink: 0; }
        .app-logo { display: flex; align-items: center; gap: 10px; }
        .app-logo-icon { font-size: 26px; }
        .app-logo-text { font-family: 'Orbitron', sans-serif; font-size: 13px; font-weight: 700; background: linear-gradient(135deg, var(--cyan), var(--purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .header-btn { width: 38px; height: 38px; border: none; background: rgba(255,255,255,0.05); border-radius: 10px; color: var(--text-dim); font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .header-btn:active { transform: scale(0.95); }

        /* ========== å…§å®¹å€ ========== */
        .app-content { flex: 1; overflow: hidden; position: relative; }
        .page { position: absolute; top: 0; left: 0; right: 0; bottom: 0; overflow-y: auto; padding: 16px; padding-bottom: calc(var(--nav-height) + 20px); display: none; -webkit-overflow-scrolling: touch; }
        .page.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* ========== åº•éƒ¨å°èˆª ========== */
        .bottom-nav { height: var(--nav-height); background: var(--bg-card); border-top: 1px solid var(--border); display: flex; flex-shrink: 0; }
        .nav-item { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; border: none; background: transparent; color: var(--text-muted); cursor: pointer; position: relative; transition: color 0.3s; }
        .nav-item::before { content: ''; position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 0; height: 3px; background: linear-gradient(90deg, var(--cyan), var(--purple)); border-radius: 0 0 3px 3px; transition: width 0.3s; }
        .nav-item.active { color: var(--cyan); }
        .nav-item.active::before { width: 36px; }
        .nav-icon { font-size: 22px; }
        .nav-label { font-size: 10px; font-weight: 500; }

        /* ========== å¡ç‰‡ ========== */
        .card { background: var(--bg-card); border-radius: 16px; padding: 18px; margin-bottom: 14px; border: 1px solid var(--border); }
        .card-header { display: flex; align-items: center; gap: 12px; margin-bottom: 14px; }
        .card-icon { width: 42px; height: 42px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .card-icon.cyan { background: var(--cyan-glow); }
        .card-icon.purple { background: var(--purple-glow); }
        .card-icon.pink { background: var(--pink-glow); }
        .card-icon.gold { background: var(--gold-glow); }
        .card-icon.emerald { background: var(--emerald-glow); }
        .card-title { font-size: 15px; font-weight: 600; }
        .card-subtitle { font-size: 11px; color: var(--text-dim); }

        /* ========== è¡¨å–® ========== */
        .form-group { margin-bottom: 14px; }
        .form-label { display: flex; align-items: center; justify-content: space-between; font-size: 13px; font-weight: 500; color: var(--text-dim); margin-bottom: 8px; }
        .form-input, .form-textarea, .form-select { width: 100%; padding: 12px 14px; background: var(--bg-input); border: 2px solid var(--border); border-radius: 10px; color: var(--text-light); font-size: 14px; font-family: inherit; transition: all 0.3s; -webkit-appearance: none; }
        .form-input:focus, .form-textarea:focus, .form-select:focus { outline: none; border-color: var(--cyan); box-shadow: 0 0 0 3px var(--cyan-glow); }
        .form-textarea { min-height: 100px; resize: vertical; line-height: 1.5; }
        .form-select { cursor: pointer; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; padding-right: 40px; }
        .form-hint { font-size: 11px; color: var(--text-muted); margin-top: 6px; }

        /* ========== AI å»ºè­°æŒ‰éˆ• ========== */
        .ai-suggest-btn { padding: 6px 12px; background: linear-gradient(135deg, var(--purple), var(--pink)); border: none; border-radius: 8px; color: white; font-size: 11px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 4px; }
        .ai-suggest-btn:active { transform: scale(0.95); }
        .ai-suggest-btn .spinner { display: none; width: 12px; height: 12px; border: 2px solid rgba(255,255,255,0.3); border-top-color: white; border-radius: 50%; animation: spin 0.8s linear infinite; }
        .ai-suggest-btn.loading .spinner { display: block; }
        .ai-suggest-btn.loading span { display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ========== é¢¨æ ¼é¸æ“‡å™¨ ========== */
        .style-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 12px; max-height: 280px; overflow-y: auto; padding: 4px; }
        .style-item { position: relative; padding: 10px 6px; background: var(--bg-input); border: 2px solid var(--border); border-radius: 10px; cursor: pointer; text-align: center; transition: all 0.2s; }
        .style-item:hover { border-color: var(--purple); background: rgba(168, 85, 247, 0.1); }
        .style-item.selected { border-color: var(--cyan); background: rgba(0, 245, 255, 0.15); }
        .style-item.selected::after { content: 'âœ“'; position: absolute; top: 4px; right: 4px; width: 16px; height: 16px; background: var(--cyan); border-radius: 50%; font-size: 10px; color: var(--bg-dark); display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .style-icon { font-size: 24px; margin-bottom: 4px; }
        .style-name { font-size: 10px; color: var(--text-light); line-height: 1.2; }
        .style-custom { border-style: dashed; }
        .style-custom .style-icon { opacity: 0.5; }

        /* ========== æ•¸é‡é¸æ“‡å™¨ ========== */
        .quantity-row { display: flex; align-items: center; gap: 12px; }
        .qty-btn { width: 40px; height: 40px; border: 2px solid var(--border); background: var(--bg-input); border-radius: 10px; color: var(--text-light); font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .qty-btn:hover { border-color: var(--cyan); }
        .qty-btn:active { transform: scale(0.95); }
        .qty-display { flex: 1; text-align: center; }
        .qty-value { font-family: 'Orbitron', sans-serif; font-size: 32px; font-weight: 700; color: var(--cyan); }
        .qty-label { font-size: 12px; color: var(--text-dim); }

        /* ========== æ¨¡å‹é¸æ“‡ ========== */
        .model-options { display: flex; flex-direction: column; gap: 8px; }
        .model-option { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--bg-input); border: 2px solid var(--border); border-radius: 10px; cursor: pointer; transition: all 0.2s; }
        .model-option:hover { border-color: var(--purple); }
        .model-option.selected { border-color: var(--cyan); background: rgba(0, 245, 255, 0.1); }
        .model-option input { display: none; }
        .model-radio { width: 20px; height: 20px; border: 2px solid var(--border); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .model-option.selected .model-radio { border-color: var(--cyan); }
        .model-option.selected .model-radio::after { content: ''; width: 10px; height: 10px; background: var(--cyan); border-radius: 50%; }
        .model-info { flex: 1; }
        .model-name { font-size: 14px; font-weight: 600; }
        .model-desc { font-size: 11px; color: var(--text-dim); }
        .model-badge { padding: 3px 8px; background: var(--purple-glow); border-radius: 6px; font-size: 10px; color: var(--purple); font-weight: 600; }
        .model-badge.new { background: var(--emerald-glow); color: var(--emerald); }
        .model-badge.best { background: var(--gold-glow); color: var(--gold); }

        /* ========== è¼¸å‡ºé¸é … ========== */
        .output-options { display: flex; flex-direction: column; gap: 10px; }
        .output-option { display: flex; align-items: center; gap: 12px; padding: 12px; background: var(--bg-input); border: 2px solid var(--border); border-radius: 10px; cursor: pointer; }
        .output-option.selected { border-color: var(--emerald); background: rgba(0, 255, 136, 0.1); }
        .output-checkbox { width: 22px; height: 22px; border: 2px solid var(--border); border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 14px; color: var(--bg-dark); flex-shrink: 0; }
        .output-option.selected .output-checkbox { background: var(--emerald); border-color: var(--emerald); }
        .output-icon { font-size: 24px; }
        .output-info { flex: 1; }
        .output-name { font-size: 13px; font-weight: 600; }
        .output-desc { font-size: 11px; color: var(--text-dim); }

        /* ========== æŒ‰éˆ• ========== */
        .btn { width: 100%; padding: 14px 20px; border: none; border-radius: 12px; font-size: 15px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.3s; }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: linear-gradient(135deg, var(--cyan), var(--purple)); color: white; }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-secondary { background: var(--bg-card-hover); color: var(--text-light); border: 2px solid var(--border); }
        .btn-success { background: linear-gradient(135deg, var(--emerald), #059669); color: white; }
        .btn-danger { background: var(--red); color: white; }
        .btn-sm { padding: 10px 16px; font-size: 13px; }

        /* ========== ç”Ÿæˆé€²åº¦ ========== */
        .generation-progress { display: none; }
        .generation-progress.active { display: block; }
        .progress-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
        .progress-title { font-size: 14px; font-weight: 600; }
        .progress-count { font-size: 13px; color: var(--cyan); }
        .progress-bar-container { height: 8px; background: var(--bg-input); border-radius: 4px; overflow: hidden; margin-bottom: 16px; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, var(--cyan), var(--purple), var(--pink)); border-radius: 4px; transition: width 0.5s ease; }
        .progress-status { font-size: 12px; color: var(--text-dim); text-align: center; margin-bottom: 16px; }
        .progress-log { max-height: 150px; overflow-y: auto; background: var(--bg-input); border-radius: 10px; padding: 12px; font-size: 11px; font-family: monospace; }
        .log-item { padding: 4px 0; border-bottom: 1px solid var(--border); }
        .log-item:last-child { border-bottom: none; }
        .log-item.success { color: var(--emerald); }
        .log-item.error { color: var(--red); }
        .log-item.info { color: var(--cyan); }

        /* ========== çµæœå±•ç¤º ========== */
        .results-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .result-item { background: var(--bg-input); border-radius: 12px; overflow: hidden; border: 1px solid var(--border); }
        .result-image { width: 100%; aspect-ratio: 1; object-fit: cover; background: var(--bg-card); }
        .result-info { padding: 10px; }
        .result-style { font-size: 11px; color: var(--cyan); font-weight: 600; margin-bottom: 4px; }
        .result-actions { display: flex; gap: 6px; }
        .result-btn { flex: 1; padding: 8px; background: var(--bg-card); border: 1px solid var(--border); border-radius: 6px; color: var(--text-dim); font-size: 16px; cursor: pointer; }
        .result-btn:hover { background: var(--cyan-glow); color: var(--cyan); }

        /* ========== è¨­å®šé  ========== */
        .setting-item { display: flex; align-items: center; justify-content: space-between; padding: 14px 0; border-bottom: 1px solid var(--border); }
        .setting-item:last-child { border-bottom: none; }
        .setting-info { flex: 1; }
        .setting-name { font-size: 14px; font-weight: 500; }
        .setting-desc { font-size: 11px; color: var(--text-dim); }
        .setting-value { font-size: 12px; color: var(--cyan); }

        /* ========== Toast ========== */
        .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(100px); background: var(--bg-card); border: 1px solid var(--border); padding: 12px 20px; border-radius: 12px; font-size: 13px; z-index: 1000; opacity: 0; transition: all 0.3s; pointer-events: none; }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        .toast.success { border-color: var(--emerald); color: var(--emerald); }
        .toast.error { border-color: var(--red); color: var(--red); }

        /* ========== Modal ========== */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; }
        .modal-overlay.show { display: flex; }
        .modal { background: var(--bg-card); border-radius: 20px; width: 100%; max-width: 400px; max-height: 80vh; overflow: hidden; }
        .modal-header { padding: 16px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; }
        .modal-title { font-size: 16px; font-weight: 600; }
        .modal-close { width: 32px; height: 32px; border: none; background: transparent; color: var(--text-dim); font-size: 20px; cursor: pointer; border-radius: 8px; }
        .modal-body { padding: 16px; max-height: 60vh; overflow-y: auto; }
        .modal-footer { padding: 16px; border-top: 1px solid var(--border); }

        /* ========== Image Lightbox ========== */
        .lightbox { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.95); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 3000; padding: 20px; }
        .lightbox.show { display: flex; }
        .lightbox-header { position: absolute; top: 0; left: 0; right: 0; padding: 16px 20px; display: flex; align-items: center; justify-content: space-between; background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, transparent 100%); }
        .lightbox-title { font-size: 16px; font-weight: 600; color: #fff; }
        .lightbox-close { width: 44px; height: 44px; border: none; background: rgba(255,255,255,0.1); color: #fff; font-size: 24px; cursor: pointer; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .lightbox-close:hover { background: rgba(255,255,255,0.2); transform: scale(1.1); }
        .lightbox-image { max-width: 90%; max-height: 80vh; object-fit: contain; border-radius: 12px; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
        .lightbox-hint { position: absolute; bottom: 20px; color: rgba(255,255,255,0.5); font-size: 12px; }

        /* ========== è‡ªè¨‚é¢¨æ ¼ Modal ========== */
        .custom-style-list { max-height: 200px; overflow-y: auto; margin-bottom: 12px; }
        .custom-style-item { display: flex; align-items: center; gap: 10px; padding: 10px; background: var(--bg-input); border-radius: 8px; margin-bottom: 8px; }
        .custom-style-item .style-icon { font-size: 20px; }
        .custom-style-item .style-text { flex: 1; font-size: 12px; }
        .custom-style-item .delete-btn { width: 28px; height: 28px; border: none; background: rgba(255, 51, 102, 0.2); color: var(--red); border-radius: 6px; cursor: pointer; font-size: 14px; }

        /* ========== è¼¸å…¥æ¡† + é¡¯ç¤º/éš±è—æŒ‰éˆ• ========== */
        .input-with-toggle { position: relative; display: flex; align-items: center; }
        .input-with-toggle .form-input { padding-right: 50px; }
        .toggle-visibility { position: absolute; right: 8px; width: 36px; height: 36px; border: none; background: var(--bg-card); border-radius: 8px; color: var(--text-dim); font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .toggle-visibility:hover { background: var(--cyan-glow); color: var(--cyan); }
        .toggle-visibility.active { background: var(--cyan); color: var(--bg-dark); }

        /* ========== æŒ‰éˆ•ç¾¤çµ„ ========== */
        .btn-group { display: flex; gap: 8px; margin-top: 12px; }
        .btn-group .btn { flex: 1; }
        .btn-success { background: linear-gradient(135deg, var(--emerald), #059669); color: white; }
        .btn-danger { background: linear-gradient(135deg, var(--red), #dc2626); color: white; }

        /* ========== æ¬„ä½ç‹€æ…‹é¡¯ç¤º ========== */
        .field-status { margin-top: 10px; padding: 8px 12px; border-radius: 8px; font-size: 12px; display: none; }
        .field-status.show { display: block; animation: fadeIn 0.3s ease; }
        .field-status.success { background: rgba(0, 255, 136, 0.1); color: var(--emerald); border: 1px solid rgba(0, 255, 136, 0.3); }
        .field-status.error { background: rgba(255, 51, 102, 0.1); color: var(--red); border: 1px solid rgba(255, 51, 102, 0.3); }
        .field-status.info { background: rgba(0, 245, 255, 0.1); color: var(--cyan); border: 1px solid rgba(0, 245, 255, 0.3); }
        .field-status.warning { background: rgba(255, 215, 0, 0.1); color: var(--gold); border: 1px solid rgba(255, 215, 0, 0.3); }

        /* éš±è— scrollbar */
        .style-grid::-webkit-scrollbar, .progress-log::-webkit-scrollbar, .custom-style-list::-webkit-scrollbar { width: 4px; }
        .style-grid::-webkit-scrollbar-track, .progress-log::-webkit-scrollbar-track { background: transparent; }
        .style-grid::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }
    </style>
</head>
<body>
    <!-- ========== é–‹æ©Ÿå‹•ç•« ========== -->
    <div class="splash-screen" id="splashScreen">
        <div class="splash-content">
            <div class="splash-icon-wrap">
                <!-- æ—‹è½‰å…‰ç’° -->
                <div class="splash-ring splash-ring-1"></div>
                <div class="splash-ring splash-ring-2"></div>
                <div class="splash-ring splash-ring-3"></div>
                <!-- æƒæç·š -->
                <div class="splash-scan"></div>
                <!-- è¶…å­—æ ¸å¿ƒ -->
                <div class="splash-icon">è¶…</div>
                <!-- ç²’å­ -->
                <div class="splash-dots">
                    <div class="splash-dot"></div>
                    <div class="splash-dot"></div>
                    <div class="splash-dot"></div>
                    <div class="splash-dot"></div>
                </div>
            </div>
            <div class="splash-title">SUPER INSTRUCTION</div>
            <div class="splash-subtitle">è¶…ç´šæŒ‡ä»¤æ’ç•«ç”Ÿæˆå™¨ Pro</div>
            <div class="splash-progress">
                <div class="splash-progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- ========== APP ä¸»é«” ========== -->
    <div class="app-container">
        <!-- é ‚éƒ¨æ¨™é¡Œ -->
        <header class="app-header">
            <div class="app-logo">
                <span class="app-logo-icon">ğŸ¨</span>
                <span class="app-logo-text">SUPER INSTRUCTION</span>
            </div>
            <div style="display:flex;gap:8px;">
                <button class="header-btn" onclick="showHelpModal()">â“</button>
                <button class="header-btn" onclick="switchPage('settings')">âš™ï¸</button>
            </div>
        </header>

        <!-- å…§å®¹å€ -->
        <main class="app-content">
            <!-- ===== é¦–é ï¼šç”Ÿæˆè¨­å®š ===== -->
            <div class="page active" id="page-home">
                <!-- ä¸»é«”æè¿° -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon cyan">âœï¸</div>
                        <div>
                            <div class="card-title">ä¸»é«”æè¿°</div>
                            <div class="card-subtitle">æè¿°ä½ æƒ³ç”Ÿæˆçš„æ’åœ–å…§å®¹</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-label">
                            <span>æ’åœ–å…§å®¹</span>
                            <button class="ai-suggest-btn" id="aiSuggestBtn" onclick="getAISuggestion()">
                                <div class="spinner"></div>
                                <span>âœ¨ AI å»ºè­°</span>
                            </button>
                            <button class="ai-suggest-btn" onclick="clearSubject()" style="background:linear-gradient(135deg,#ff6b6b,#ee5a24);margin-left:8px;">
                                <span>ğŸ—‘ï¸ æ¸…é™¤</span>
                            </button>
                        </div>
                        <textarea class="form-textarea" id="subjectInput" placeholder="ä¾‹å¦‚ï¼šä¸€éš»æˆ´è‘—å¾©å¤é£›è¡Œå“¡é¢¨é¡çš„æŸ¯åŸºçŠ¬ï¼Œååœ¨ä¸€æ¶èˆŠå¼é›™ç¿¼é£›æ©Ÿçš„é–‹æ”¾å¼é§•é§›è‰™è£¡ï¼ŒèƒŒæ™¯æ˜¯é›²æµ·å’Œå¤•é™½ã€‚"></textarea>
                        <div class="form-hint">ğŸ’¡ æè¿°è¶Šè©³ç´°ï¼Œç”Ÿæˆæ•ˆæœè¶Šå¥½</div>
                    </div>
                </div>

                <!-- é¢¨æ ¼é¸æ“‡ -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon purple">ğŸ­</div>
                        <div>
                            <div class="card-title">é¸æ“‡é¢¨æ ¼</div>
                            <div class="card-subtitle">å·²é¸æ“‡ <span id="selectedStyleCount">0</span> ç¨®é¢¨æ ¼</div>
                        </div>
                    </div>
                    <div class="style-grid" id="styleGrid">
                        <!-- å‹•æ…‹ç”Ÿæˆ -->
                    </div>
                    <button class="btn btn-secondary btn-sm" onclick="showCustomStyleModal()">â• æ–°å¢è‡ªè¨‚é¢¨æ ¼</button>
                </div>

                <!-- ç”Ÿæˆæ•¸é‡ -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon gold">ğŸ”¢</div>
                        <div>
                            <div class="card-title">ç”Ÿæˆæ•¸é‡</div>
                            <div class="card-subtitle">æ¯ç¨®é¢¨æ ¼ç”Ÿæˆçš„åœ–ç‰‡æ•¸</div>
                        </div>
                    </div>
                    <div class="quantity-row">
                        <button class="qty-btn" onclick="adjustQuantity(-1)">âˆ’</button>
                        <div class="qty-display">
                            <div class="qty-value" id="quantityValue">1</div>
                            <div class="qty-label">å¼µ / é¢¨æ ¼</div>
                        </div>
                        <button class="qty-btn" onclick="adjustQuantity(1)">+</button>
                    </div>
                    <div class="form-hint" style="text-align:center;margin-top:10px;">
                        ğŸ“Š ç¸½è¨ˆå°‡ç”Ÿæˆ <strong id="totalImages">0</strong> å¼µåœ–ç‰‡
                    </div>
                </div>

                <!-- AI æ¨¡å‹é¸æ“‡ -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon pink">ğŸ¤–</div>
                        <div>
                            <div class="card-title">AI æ¨¡å‹</div>
                            <div class="card-subtitle">é¸æ“‡åœ–ç‰‡ç”Ÿæˆå¼•æ“</div>
                        </div>
                    </div>
                    <div class="model-options" id="modelOptions">
                        <label class="model-option selected" onclick="selectModel('gemini-2.0-flash')">
                            <input type="radio" name="model" value="gemini-2.0-flash" checked>
                            <div class="model-radio"></div>
                            <div class="model-info">
                                <div class="model-name">Gemini 2.0 Flash</div>
                                <div class="model-desc">ç©©å®šå¯ç”¨ï¼Œæ¨è–¦ä½¿ç”¨</div>
                            </div>
                            <span class="model-badge">æ¨è–¦</span>
                        </label>
                        <label class="model-option" onclick="selectModel('gemini-2.5-flash')">
                            <input type="radio" name="model" value="gemini-2.5-flash">
                            <div class="model-radio"></div>
                            <div class="model-info">
                                <div class="model-name">Gemini 2.5 Flash</div>
                                <div class="model-desc">æ›´é«˜å“è³ªï¼Œç´°ç¯€æ›´è±å¯Œ</div>
                            </div>
                            <span class="model-badge new">NEW</span>
                        </label>
                        <label class="model-option" onclick="selectModel('imagen-4')">
                            <input type="radio" name="model" value="imagen-4">
                            <div class="model-radio"></div>
                            <div class="model-info">
                                <div class="model-name">Imagen 4</div>
                                <div class="model-desc">Google æœ€å¼·åœ–åƒæ¨¡å‹ï¼ˆä»˜è²»ï¼‰</div>
                            </div>
                            <span class="model-badge best">PRO</span>
                        </label>
                    </div>
                </div>

                <!-- è¼¸å‡ºé¸é … -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon emerald">ğŸ“¤</div>
                        <div>
                            <div class="card-title">è¼¸å‡ºé¸é …</div>
                            <div class="card-subtitle">é¸æ“‡åœ–ç‰‡çš„è¼¸å‡ºæ–¹å¼</div>
                        </div>
                    </div>
                    <div class="output-options">
                        <div class="output-option selected" onclick="toggleOutput(this, 'download')">
                            <div class="output-checkbox">âœ“</div>
                            <div class="output-icon">ğŸ’¾</div>
                            <div class="output-info">
                                <div class="output-name">æœ¬æ©Ÿä¸‹è¼‰</div>
                                <div class="output-desc">ç›´æ¥ä¸‹è¼‰åˆ°è£ç½®</div>
                            </div>
                        </div>
                        <div class="output-option" onclick="toggleOutput(this, 'photos')">
                            <div class="output-checkbox">âœ“</div>
                            <div class="output-icon">ğŸ“·</div>
                            <div class="output-info">
                                <div class="output-name">Google ç›¸ç°¿</div>
                                <div class="output-desc">ä¸Šå‚³åˆ°ã€Œè¶…ç´šæŒ‡ä»¤æ’ç•«ç”Ÿæˆå€ã€</div>
                            </div>
                        </div>
                        <div class="output-option" onclick="toggleOutput(this, 'docs')">
                            <div class="output-checkbox">âœ“</div>
                            <div class="output-icon">ğŸ“š</div>
                            <div class="output-info">
                                <div class="output-name">æ’ç•«åœ–é‘‘</div>
                                <div class="output-desc">å»ºç«‹ã€Œè¶…ç´šæŒ‡ä»¤æ’ç•«åœ–é‘‘ã€Doc</div>
                            </div>
                        </div>
                        <div class="output-option" onclick="toggleOutput(this, 'line')">
                            <div class="output-checkbox">âœ“</div>
                            <div class="output-icon">ğŸ’¬</div>
                            <div class="output-info">
                                <div class="output-name">LINE é€šçŸ¥</div>
                                <div class="output-desc">å®Œæˆå¾Œç™¼é€é€šçŸ¥å«é€£çµ</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- é–‹å§‹ç”ŸæˆæŒ‰éˆ• -->
                <button class="btn btn-primary" id="generateBtn" onclick="startGeneration()">
                    ğŸš€ é–‹å§‹ç”Ÿæˆ
                </button>

                <!-- ç”Ÿæˆé€²åº¦ -->
                <div class="card generation-progress" id="generationProgress">
                    <div class="progress-header">
                        <span class="progress-title">ğŸ¨ ç”Ÿæˆä¸­...</span>
                        <span class="progress-count" id="progressCount">0 / 0</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                    </div>
                    <div class="progress-status" id="progressStatus">æº–å‚™ä¸­...</div>
                    <div class="progress-log" id="progressLog"></div>
                    <button class="btn btn-danger btn-sm" style="margin-top:12px;" onclick="cancelGeneration()">â¹ï¸ å–æ¶ˆç”Ÿæˆ</button>
                </div>
            </div>

            <!-- ===== çµæœé  ===== -->
            <div class="page" id="page-results">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon cyan">ğŸ–¼ï¸</div>
                        <div>
                            <div class="card-title">ç”Ÿæˆçµæœ</div>
                            <div class="card-subtitle" id="resultsSubtitle">å…± 0 å¼µåœ–ç‰‡</div>
                        </div>
                    </div>
                    <div style="display:flex;gap:8px;margin-bottom:14px;">
                        <button class="btn btn-secondary btn-sm" style="flex:1" onclick="downloadAllImages()">ğŸ’¾ å…¨éƒ¨ä¸‹è¼‰</button>
                        <button class="btn btn-secondary btn-sm" style="flex:1" onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤çµæœ</button>
                    </div>
                    <div class="results-grid" id="resultsGrid">
                        <div style="grid-column:span 2;text-align:center;padding:40px;color:var(--text-muted);">
                            å°šç„¡ç”Ÿæˆçµæœ
                        </div>
                    </div>
                </div>
            </div>

            <!-- ===== è¨­å®šé  ===== -->
            <div class="page" id="page-settings">
                <!-- API Key è¨­å®š -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon purple">ğŸ”‘</div>
                        <div>
                            <div class="card-title">Gemini API Key</div>
                            <div class="card-subtitle">åœ–ç‰‡ç”Ÿæˆå¿…å‚™</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-label">API Key</div>
                        <div class="input-with-toggle">
                            <input type="password" class="form-input" id="apiKeyInput" placeholder="è¼¸å…¥ Gemini API Key">
                            <button class="toggle-visibility" onclick="toggleVisibility('apiKeyInput', this)">ğŸ‘ï¸</button>
                        </div>
                        <div class="form-hint">ğŸ’¡ å‰å¾€ <a href="https://aistudio.google.com/apikey" target="_blank" style="color:var(--cyan);">Google AI Studio</a> å–å¾—</div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-success btn-sm" onclick="saveField('apiKey')">ğŸ’¾ å„²å­˜</button>
                        <button class="btn btn-danger btn-sm" onclick="clearField('apiKey')">ğŸ—‘ï¸ æ¸…é™¤</button>
                    </div>
                    <div class="field-status" id="apiKeyStatus"></div>
                </div>

                <!-- GAS è¨­å®š -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon cyan">â˜ï¸</div>
                        <div>
                            <div class="card-title">GAS å¾Œç«¯è¨­å®š</div>
                            <div class="card-subtitle">é›²ç«¯åŠŸèƒ½å¿…å‚™</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-label">GAS Web App URL</div>
                        <div class="input-with-toggle">
                            <input type="password" class="form-input" id="gasUrlInput" placeholder="https://script.google.com/macros/s/xxx/exec">
                            <button class="toggle-visibility" onclick="toggleVisibility('gasUrlInput', this)">ğŸ‘ï¸</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-label">å®‰å…¨å¯†é‘°</div>
                        <div class="input-with-toggle">
                            <input type="password" class="form-input" id="gasSecretInput" placeholder="è¼¸å…¥å®‰å…¨å¯†é‘°">
                            <button class="toggle-visibility" onclick="toggleVisibility('gasSecretInput', this)">ğŸ‘ï¸</button>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-success btn-sm" onclick="saveField('gas')">ğŸ’¾ å„²å­˜</button>
                        <button class="btn btn-danger btn-sm" onclick="clearField('gas')">ğŸ—‘ï¸ æ¸…é™¤</button>
                        <button class="btn btn-secondary btn-sm" onclick="testGasConnection()">ğŸ”— æ¸¬è©¦é€£ç·š</button>
                    </div>
                    <div class="field-status" id="gasStatus"></div>
                </div>

                <!-- LINE è¨­å®š (é¸ç”¨) -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon emerald">ğŸ’¬</div>
                        <div>
                            <div class="card-title">LINE é€šçŸ¥è¨­å®š</div>
                            <div class="card-subtitle">é¸ç”¨ - ç”± GAS å¾Œç«¯è™•ç†</div>
                        </div>
                    </div>
                    <div style="font-size:12px;color:var(--text-dim);padding:12px;background:var(--bg-input);border-radius:10px;margin-bottom:12px;">
                        â„¹ï¸ LINE é€šçŸ¥è¨­å®šåœ¨ GAS å¾Œç«¯çš„ CONFIG å€å¡Šä¸­è¨­å®šï¼š
                        <br>â€¢ LINE_CHANNEL_ACCESS_TOKEN
                        <br>â€¢ LINE_USER_ID
                    </div>
                    <button class="btn btn-secondary btn-sm" onclick="testLineNotification()">ğŸ“¨ æ¸¬è©¦ LINE é€šçŸ¥</button>
                    <div class="field-status" id="lineStatus"></div>
                </div>

                <!-- Google OAuth è¨­å®š -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon gold">ğŸ“·</div>
                        <div>
                            <div class="card-title">Google ç›¸ç°¿</div>
                            <div class="card-subtitle">ä¸Šå‚³åœ–ç‰‡åˆ° Google Photos</div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-label">Google OAuth Client ID</div>
                        <div class="input-with-toggle">
                            <input type="password" class="form-input" id="googleClientId" placeholder="xxx.apps.googleusercontent.com">
                            <button class="toggle-visibility" onclick="toggleVisibility('googleClientId', this)">ğŸ‘ï¸</button>
                        </div>
                        <div class="form-hint">ğŸ’¡ å¾ <a href="https://console.cloud.google.com/apis/credentials" target="_blank" style="color:var(--cyan);">Google Cloud Console</a> å–å¾—</div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-success btn-sm" onclick="saveField('google')">ğŸ’¾ å„²å­˜</button>
                        <button class="btn btn-danger btn-sm" onclick="clearField('google')">ğŸ—‘ï¸ æ¸…é™¤</button>
                        <button class="btn btn-primary btn-sm" onclick="googleAuth()" style="background:linear-gradient(135deg,#4285F4,#34A853);">ğŸ” æˆæ¬Š</button>
                    </div>
                    <div class="field-status" id="googleStatus"></div>
                    <div style="margin-top:12px;padding:12px;background:var(--bg-input);border-radius:8px;font-size:11px;color:var(--text-dim);line-height:1.6;">
                        <strong>ğŸ“‹ è¨­å®šæ­¥é©Ÿï¼š</strong><br>
                        1. å‰å¾€ Google Cloud Console<br>
                        2. å»ºç«‹å°ˆæ¡ˆ â†’ å•Ÿç”¨ Photos Library API<br>
                        3. OAuth åŒæ„ç•«é¢ â†’ å¤–éƒ¨ â†’ æ–°å¢æ¸¬è©¦ä½¿ç”¨è€…<br>
                        4. æ†‘è­‰ â†’ OAuth ç”¨æˆ¶ç«¯ ID â†’ ç¶²é æ‡‰ç”¨ç¨‹å¼<br>
                        5. æˆæ¬Šçš„ JavaScript ä¾†æºï¼š<code style="color:var(--cyan);">${window.location.origin}</code><br>
                        6. è¤‡è£½ Client ID è²¼åˆ°ä¸Šæ–¹ â†’ é»æ“Šæˆæ¬Š
                    </div>
                </div>

                <!-- è³‡æ–™ç®¡ç† -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon pink">ğŸ—ƒï¸</div>
                        <div>
                            <div class="card-title">è³‡æ–™ç®¡ç†</div>
                            <div class="card-subtitle">ç®¡ç†æœ¬æ©Ÿå„²å­˜è³‡æ–™</div>
                        </div>
                    </div>
                    <div class="btn-group" style="flex-direction:column;gap:10px;">
                        <button class="btn btn-secondary btn-sm" onclick="exportSettings()">ğŸ“¤ åŒ¯å‡ºæ‰€æœ‰è¨­å®š</button>
                        <button class="btn btn-secondary btn-sm" onclick="importSettings()">ğŸ“¥ åŒ¯å…¥è¨­å®š</button>
                        <button class="btn btn-danger btn-sm" onclick="clearAllSettings()">âš ï¸ æ¸…é™¤æ‰€æœ‰è³‡æ–™</button>
                    </div>
                </div>

                <!-- é—œæ–¼ -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon gold">â„¹ï¸</div>
                        <div>
                            <div class="card-title">é—œæ–¼</div>
                            <div class="card-subtitle">è¶…ç´šæŒ‡ä»¤æ’ç•«ç”Ÿæˆå™¨ Pro</div>
                        </div>
                    </div>
                    <div style="font-size:12px;color:var(--text-dim);line-height:1.8;">
                        <p>ğŸ“¦ ç‰ˆæœ¬ï¼šv1.0.0</p>
                        <p>ğŸ“… æ›´æ–°ï¼š2025/12/11</p>
                        <p>ğŸ¨ æ”¯æ´ 20+ é è¨­é¢¨æ ¼ + ç„¡é™è‡ªè¨‚</p>
                        <p>ğŸ¤– æ”¯æ´ Gemini 2.0/2.5 Flashã€Imagen 4</p>
                        <p>ğŸ“· è‡ªå‹•ä¸Šå‚³åˆ°ã€Œè¶…ç´šæŒ‡ä»¤æ’ç•«ç”Ÿæˆå€ã€</p>
                        <p>ğŸ“š è‡ªå‹•å»ºç«‹ã€Œè¶…ç´šæŒ‡ä»¤æ’ç•«åœ–é‘‘ã€</p>
                        <p>ğŸ’¬ LINE å®Œæˆé€šçŸ¥å«é€£çµ</p>
                        <p style="margin-top:12px;padding-top:12px;border-top:1px solid var(--border);text-align:center;color:var(--text-muted);">
                            Â© 2025 è¶…ç´šæŒ‡ä»¤æ’ç•«ç”Ÿæˆå™¨ Pro<br>
                            Made with â¤ï¸ and AI
                        </p>
                    </div>
                </div>
            </div>
        </main>

        <!-- åº•éƒ¨å°èˆª -->
        <nav class="bottom-nav">
            <button class="nav-item active" onclick="switchPage('home')">
                <span class="nav-icon">ğŸ </span>
                <span class="nav-label">ç”Ÿæˆ</span>
            </button>
            <button class="nav-item" onclick="switchPage('results')">
                <span class="nav-icon">ğŸ–¼ï¸</span>
                <span class="nav-label">çµæœ</span>
            </button>
            <button class="nav-item" onclick="switchPage('settings')">
                <span class="nav-icon">âš™ï¸</span>
                <span class="nav-label">è¨­å®š</span>
            </button>
        </nav>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- è‡ªè¨‚é¢¨æ ¼ Modal -->
    <div class="modal-overlay" id="customStyleModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">â• è‡ªè¨‚é¢¨æ ¼</span>
                <button class="modal-close" onclick="closeModal('customStyleModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <div class="form-label">é¢¨æ ¼åç¨±</div>
                    <input type="text" class="form-input" id="customStyleName" placeholder="ä¾‹å¦‚ï¼šè’¸æ±½é¾å…‹">
                </div>
                <div class="form-group">
                    <div class="form-label">é¢¨æ ¼æè¿°ï¼ˆè‹±æ–‡æ•ˆæœæ›´ä½³ï¼‰</div>
                    <textarea class="form-textarea" id="customStyleDesc" placeholder="ä¾‹å¦‚ï¼šSteampunk style with brass gears, Victorian machinery, copper pipes, and industrial aesthetic"></textarea>
                </div>
                <div class="form-group">
                    <div class="form-label">é¸æ“‡åœ–ç¤º</div>
                    <div style="display:flex;flex-wrap:wrap;gap:8px;" id="iconSelector">
                        <span class="style-icon-option" onclick="selectIcon('âš™ï¸')">âš™ï¸</span>
                        <span class="style-icon-option" onclick="selectIcon('ğŸ”®')">ğŸ”®</span>
                        <span class="style-icon-option" onclick="selectIcon('ğŸŒˆ')">ğŸŒˆ</span>
                        <span class="style-icon-option" onclick="selectIcon('ğŸª')">ğŸª</span>
                        <span class="style-icon-option" onclick="selectIcon('ğŸŒ¸')">ğŸŒ¸</span>
                        <span class="style-icon-option" onclick="selectIcon('ğŸ”¥')">ğŸ”¥</span>
                        <span class="style-icon-option" onclick="selectIcon('â„ï¸')">â„ï¸</span>
                        <span class="style-icon-option" onclick="selectIcon('âš¡')">âš¡</span>
                        <span class="style-icon-option" onclick="selectIcon('ğŸŒ™')">ğŸŒ™</span>
                        <span class="style-icon-option" onclick="selectIcon('â˜€ï¸')">â˜€ï¸</span>
                        <span class="style-icon-option" onclick="selectIcon('ğŸ­')">ğŸ­</span>
                        <span class="style-icon-option" onclick="selectIcon('ğŸ¯')">ğŸ¯</span>
                    </div>
                </div>
                <div class="custom-style-list" id="customStyleList">
                    <!-- å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="addCustomStyle()">â• æ–°å¢é¢¨æ ¼</button>
            </div>
        </div>
    </div>

    <!-- å¹«åŠ© Modal -->
    <div class="modal-overlay" id="helpModal">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">â“ ä½¿ç”¨èªªæ˜</span>
                <button class="modal-close" onclick="closeModal('helpModal')">âœ•</button>
            </div>
            <div class="modal-body" style="font-size:13px;line-height:1.8;">
                <p><strong>1ï¸âƒ£ è¼¸å…¥ä¸»é«”æè¿°</strong></p>
                <p style="color:var(--text-dim);margin-bottom:12px;">æè¿°ä½ æƒ³ç”Ÿæˆçš„æ’åœ–å…§å®¹ï¼Œè¶Šè©³ç´°è¶Šå¥½ã€‚ä¹Ÿå¯ä»¥é»ã€ŒAI å»ºè­°ã€è‡ªå‹•ç”Ÿæˆå‰µæ„æè¿°ã€‚</p>
                
                <p><strong>2ï¸âƒ£ é¸æ“‡é¢¨æ ¼</strong></p>
                <p style="color:var(--text-dim);margin-bottom:12px;">å¾ 20 ç¨®é è¨­é¢¨æ ¼ä¸­é¸æ“‡ï¼Œæˆ–æ–°å¢è‡ªè¨‚é¢¨æ ¼ã€‚å¯å¤šé¸ã€‚</p>
                
                <p><strong>3ï¸âƒ£ è¨­å®šæ•¸é‡</strong></p>
                <p style="color:var(--text-dim);margin-bottom:12px;">æ¯ç¨®é¢¨æ ¼è¦ç”Ÿæˆå¹¾å¼µåœ–ï¼Œ1-12 å¼µå¯é¸ã€‚</p>
                
                <p><strong>4ï¸âƒ£ é¸æ“‡ AI æ¨¡å‹</strong></p>
                <p style="color:var(--text-dim);margin-bottom:12px;">
                    â€¢ Gemini 2.0 Flashï¼šå¿«é€Ÿç”Ÿæˆ<br>
                    â€¢ Gemini 2.5 Flashï¼šæ›´é«˜å“è³ª<br>
                    â€¢ Imagen 4ï¼šæœ€ä½³æ•ˆæœ
                </p>
                
                <p><strong>5ï¸âƒ£ é¸æ“‡è¼¸å‡ºæ–¹å¼</strong></p>
                <p style="color:var(--text-dim);">å¯åŒæ™‚é¸æ“‡å¤šç¨®è¼¸å‡ºï¼šæœ¬æ©Ÿä¸‹è¼‰ã€Google ç›¸ç°¿ã€Google æ–‡ä»¶ã€LINE é€šçŸ¥ã€‚</p>
            </div>
        </div>
    </div>

    <!-- Image Lightbox -->
    <div class="lightbox" id="imageLightbox" onclick="if(event.target===this)closeLightbox()">
        <div class="lightbox-header">
            <span class="lightbox-title" id="lightboxTitle"></span>
            <button class="lightbox-close" onclick="closeLightbox()">âœ•</button>
        </div>
        <img class="lightbox-image" id="lightboxImage" src="" alt="Preview">
        <div class="lightbox-hint">é»æ“Šç©ºç™½è™•æˆ– âœ• é—œé–‰</div>
    </div>

    <style>
        .style-icon-option { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-size: 24px; background: var(--bg-input); border: 2px solid var(--border); border-radius: 8px; cursor: pointer; }
        .style-icon-option:hover { border-color: var(--purple); }
        .style-icon-option.selected { border-color: var(--cyan); background: var(--cyan-glow); }
    </style>

    <script>
        // ============================================
        // å…¨åŸŸè®Šæ•¸
        // ============================================
        let selectedStyles = [];
        let quantity = 1;
        let selectedModel = 'gemini-2.0-flash';
        let outputOptions = { download: true, photos: false, docs: false, line: false };
        let generatedImages = [];
        let isGenerating = false;
        let cancelFlag = false;
        let selectedIcon = 'âš™ï¸';

        // é è¨­ 20 ç¨®é¢¨æ ¼
        const defaultStyles = [
            { id: 'pixar', name: 'çš®å…‹æ–¯ 3D', icon: 'ğŸ¬', desc: 'High-quality Pixar 3D animation style with rich lighting and vibrant colors' },
            { id: 'ghibli', name: 'å‰åœåŠ›', icon: 'ğŸŒ¿', desc: 'Studio Ghibli anime style with soft watercolor textures and whimsical atmosphere' },
            { id: 'ukiyo-e', name: 'æµ®ä¸–ç¹ª', icon: 'ğŸŒŠ', desc: 'Japanese Ukiyo-e woodblock print style with traditional mineral pigment colors' },
            { id: 'oil-painting', name: 'æ²¹ç•«', icon: 'ğŸ–¼ï¸', desc: 'Classical oil painting style with visible brushstrokes and rich textures' },
            { id: 'watercolor', name: 'æ°´å½©', icon: 'ğŸ’§', desc: 'Delicate watercolor style with soft edges and translucent color washes' },
            { id: 'pencil-sketch', name: 'é‰›ç­†ç´ æ', icon: 'âœï¸', desc: 'Black and white pencil sketch with dramatic shading and fine details' },
            { id: 'pixel-art', name: 'åƒç´ è—è¡“', icon: 'ğŸ‘¾', desc: '8-bit retro pixel art style with limited color palette' },
            { id: 'cyberpunk', name: 'è³½åšé¾å…‹', icon: 'ğŸŒƒ', desc: '80s cyberpunk style with neon lights, glitch effects, and dark atmosphere' },
            { id: 'steampunk', name: 'è’¸æ±½é¾å…‹', icon: 'âš™ï¸', desc: 'Victorian steampunk with brass gears, copper pipes, and industrial machinery' },
            { id: 'art-nouveau', name: 'æ–°è—è¡“', icon: 'ğŸŒº', desc: 'Art Nouveau style with organic curves, floral patterns, and decorative borders' },
            { id: 'pop-art', name: 'æ™®æ™®è—è¡“', icon: 'ğŸ¨', desc: 'Andy Warhol pop art style with bold colors, halftone dots, and comic elements' },
            { id: 'minimalist', name: 'æ¥µç°¡ä¸»ç¾©', icon: 'â¬œ', desc: 'Minimalist style with clean lines, limited colors, and negative space' },
            { id: 'surrealism', name: 'è¶…ç¾å¯¦ä¸»ç¾©', icon: 'ğŸ‘ï¸', desc: 'Salvador Dali surrealism with dreamlike imagery and impossible perspectives' },
            { id: 'impressionist', name: 'å°è±¡æ´¾', icon: 'ğŸŒ»', desc: 'Monet impressionist style with visible brushstrokes and light effects' },
            { id: 'manga', name: 'æ—¥æ¼«é¢¨æ ¼', icon: 'ğŸ“–', desc: 'Japanese manga style with bold outlines, screentones, and dynamic poses' },
            { id: 'chibi', name: 'Qç‰ˆèŒç³»', icon: 'ğŸ¥°', desc: 'Chibi kawaii style with big eyes, small body, and cute expressions' },
            { id: 'realistic', name: 'å¯«å¯¦æ”å½±', icon: 'ğŸ“¸', desc: 'Photorealistic style with accurate lighting, textures, and details' },
            { id: 'low-poly', name: 'ä½å¤šé‚Šå½¢', icon: 'ğŸ“', desc: 'Low poly 3D style with geometric shapes and flat shading' },
            { id: 'ink-wash', name: 'æ°´å¢¨ç•«', icon: 'ğŸ–Œï¸', desc: 'Traditional Chinese ink wash painting with flowing brushstrokes' },
            { id: 'vaporwave', name: 'è’¸æ°£æ³¢', icon: 'ğŸŒ´', desc: '90s vaporwave aesthetic with pink/blue gradients, Greek statues, and retro tech' }
        ];

        let customStyles = [];

        // ============================================
        // åˆå§‹åŒ–
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            // é–‹æ©Ÿå‹•ç•«
            setTimeout(() => {
                document.getElementById('splashScreen').classList.add('fade-out');
                setTimeout(() => {
                    document.getElementById('splashScreen').style.display = 'none';
                }, 800);
            }, 2500);

            // è¼‰å…¥è¨­å®š
            loadSettings();
            
            // æ¸²æŸ“é¢¨æ ¼é¸æ“‡å™¨
            renderStyleGrid();
            
            // æ›´æ–°ç¸½æ•¸é¡¯ç¤º
            updateTotalImages();
        });

        // ============================================
        // é é¢åˆ‡æ›
        // ============================================
        function switchPage(pageName) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById('page-' + pageName).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // ============================================
        // é¢¨æ ¼é¸æ“‡å™¨
        // ============================================
        function renderStyleGrid() {
            const grid = document.getElementById('styleGrid');
            const allStyles = [...defaultStyles, ...customStyles];
            
            grid.innerHTML = allStyles.map(style => `
                <div class="style-item ${selectedStyles.includes(style.id) ? 'selected' : ''}" 
                     onclick="toggleStyle('${style.id}')">
                    <div class="style-icon">${style.icon}</div>
                    <div class="style-name">${style.name}</div>
                </div>
            `).join('') + `
                <div class="style-item style-custom" onclick="showCustomStyleModal()">
                    <div class="style-icon">â•</div>
                    <div class="style-name">è‡ªè¨‚é¢¨æ ¼</div>
                </div>
            `;
            
            updateSelectedCount();
        }

        function toggleStyle(styleId) {
            const index = selectedStyles.indexOf(styleId);
            if (index > -1) {
                selectedStyles.splice(index, 1);
            } else {
                selectedStyles.push(styleId);
            }
            renderStyleGrid();
            updateTotalImages();
        }

        function updateSelectedCount() {
            document.getElementById('selectedStyleCount').textContent = selectedStyles.length;
        }

        // ============================================
        // æ•¸é‡é¸æ“‡
        // ============================================
        function adjustQuantity(delta) {
            quantity = Math.max(1, Math.min(12, quantity + delta));
            document.getElementById('quantityValue').textContent = quantity;
            updateTotalImages();
        }

        function updateTotalImages() {
            const total = selectedStyles.length * quantity;
            document.getElementById('totalImages').textContent = total;
        }

        // ============================================
        // æ¨¡å‹é¸æ“‡
        // ============================================
        function selectModel(model) {
            selectedModel = model;
            document.querySelectorAll('.model-option').forEach(opt => {
                opt.classList.toggle('selected', opt.querySelector('input').value === model);
            });
        }

        // ============================================
        // è¼¸å‡ºé¸é …
        // ============================================
        function toggleOutput(element, option) {
            outputOptions[option] = !outputOptions[option];
            element.classList.toggle('selected', outputOptions[option]);
        }

        // ============================================
        // AI å»ºè­°
        // ============================================
        // æ¸…é™¤ä¸»é¡Œè¼¸å…¥
        function clearSubject() {
            document.getElementById('subjectInput').value = '';
            showToast('å·²æ¸…é™¤ä¸»é¡Œ', 'info');
        }

        async function getAISuggestion() {
            const apiKey = localStorage.getItem('geminiApiKey');
            if (!apiKey) {
                showToast('è«‹å…ˆè¨­å®š API Key', 'error');
                return;
            }

            const btn = document.getElementById('aiSuggestBtn');
            btn.classList.add('loading');

            try {
                const prompt = `ä½ æ˜¯ä¸€å€‹å‰µæ„æ’åœ–æè¿°å°ˆå®¶ã€‚è«‹ç”Ÿæˆä¸€å€‹ç¨ç‰¹ã€æœ‰è¶£ã€é©åˆAIåœ–åƒç”Ÿæˆçš„æ’åœ–æè¿°ã€‚

è¦æ±‚ï¼š
1. æè¿°è¦å…·é«”ã€ç”Ÿå‹•ã€æœ‰ç•«é¢æ„Ÿ
2. åŒ…å«ä¸»é«”ã€å‹•ä½œã€å ´æ™¯ã€æ°›åœ
3. é©åˆå„ç¨®è—è¡“é¢¨æ ¼å‘ˆç¾
4. ä¸­æ–‡æè¿°ï¼Œç´„50-100å­—

è«‹ç›´æ¥è¼¸å‡ºæè¿°ï¼Œä¸è¦åŠ ä»»ä½•å‰ç¶´æˆ–è§£é‡‹ã€‚`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: { temperature: 1.0 }
                    })
                });

                const data = await response.json();
                if (data.candidates && data.candidates[0]) {
                    const suggestion = data.candidates[0].content.parts[0].text.trim();
                    document.getElementById('subjectInput').value = suggestion;
                    showToast('âœ¨ AI å»ºè­°å·²ç”Ÿæˆ', 'success');
                }
            } catch (error) {
                console.error('AI å»ºè­°éŒ¯èª¤:', error);
                showToast('AI å»ºè­°å¤±æ•—', 'error');
            } finally {
                btn.classList.remove('loading');
            }
        }

        // ============================================
        // é–‹å§‹ç”Ÿæˆ
        // ============================================
        async function startGeneration() {
            const subject = document.getElementById('subjectInput').value.trim();
            const apiKey = localStorage.getItem('geminiApiKey');

            if (!subject) {
                showToast('è«‹è¼¸å…¥ä¸»é«”æè¿°', 'error');
                return;
            }

            if (!apiKey) {
                showToast('è«‹å…ˆè¨­å®š API Key', 'error');
                switchPage('settings');
                return;
            }

            if (selectedStyles.length === 0) {
                showToast('è«‹è‡³å°‘é¸æ“‡ä¸€ç¨®é¢¨æ ¼', 'error');
                return;
            }

            // é¡¯ç¤ºé€²åº¦
            isGenerating = true;
            cancelFlag = false;
            generatedImages = [];
            
            document.getElementById('generateBtn').style.display = 'none';
            document.getElementById('generationProgress').classList.add('active');
            
            const allStyles = [...defaultStyles, ...customStyles];
            const totalImages = selectedStyles.length * quantity;
            let currentIndex = 0;

            document.getElementById('progressCount').textContent = `0 / ${totalImages}`;
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('progressLog').innerHTML = '';

            addLog('ğŸš€ é–‹å§‹ç”Ÿæˆä»»å‹™...', 'info');
            addLog(`ğŸ“ ä¸»é¡Œ: ${subject.substring(0, 30)}...`, 'info');
            addLog(`ğŸ¨ é¢¨æ ¼æ•¸: ${selectedStyles.length}`, 'info');
            addLog(`ğŸ”¢ æ¯é¢¨æ ¼æ•¸é‡: ${quantity}`, 'info');
            addLog(`ğŸ¤– ä½¿ç”¨æ¨¡å‹: ${selectedModel}`, 'info');

            for (const styleId of selectedStyles) {
                if (cancelFlag) break;

                const style = allStyles.find(s => s.id === styleId);
                if (!style) continue;

                for (let i = 0; i < quantity; i++) {
                    if (cancelFlag) break;

                    currentIndex++;
                    const progress = (currentIndex / totalImages) * 100;
                    
                    document.getElementById('progressCount').textContent = `${currentIndex} / ${totalImages}`;
                    document.getElementById('progressBar').style.width = progress + '%';
                    document.getElementById('progressStatus').textContent = `æ­£åœ¨ç”Ÿæˆ: ${style.name} (${i + 1}/${quantity})`;

                    addLog(`ğŸ¨ ç”Ÿæˆ ${style.name} #${i + 1}...`, 'info');

                    try {
                        const imageData = await generateImage(subject, style, apiKey);
                        if (imageData) {
                            generatedImages.push({
                                style: style.name,
                                styleId: style.id,
                                data: imageData,
                                timestamp: Date.now()
                            });
                            addLog(`âœ… ${style.name} #${i + 1} å®Œæˆ`, 'success');
                        }
                    } catch (error) {
                        addLog(`âŒ ${style.name} #${i + 1} å¤±æ•—: ${error.message}`, 'error');
                    }

                    // å»¶é²é¿å… rate limit
                    if (currentIndex < totalImages) {
                        await sleep(1500);
                    }
                }
            }

            // å®Œæˆ
            isGenerating = false;
            
            if (!cancelFlag) {
                addLog(`ğŸ‰ ç”Ÿæˆå®Œæˆ! å…± ${generatedImages.length} å¼µåœ–ç‰‡`, 'success');
                document.getElementById('progressStatus').textContent = 'âœ… ç”Ÿæˆå®Œæˆ!';

                // è™•ç†è¼¸å‡º
                await handleOutputs();
                
                // æ›´æ–°çµæœé 
                renderResults();
                
                showToast(`ğŸ‰ å·²ç”Ÿæˆ ${generatedImages.length} å¼µåœ–ç‰‡`, 'success');
            } else {
                addLog('â¹ï¸ å·²å–æ¶ˆç”Ÿæˆ', 'error');
                document.getElementById('progressStatus').textContent = 'å·²å–æ¶ˆ';
            }

            // æ¢å¾©æŒ‰éˆ•
            setTimeout(() => {
                document.getElementById('generateBtn').style.display = 'flex';
                document.getElementById('generationProgress').classList.remove('active');
            }, 2000);
        }

        // ============================================
        // ç”Ÿæˆå–®å¼µåœ–ç‰‡
        // ============================================
        async function generateImage(subject, style, apiKey) {
            const prompt = `Create an illustration: ${subject}

Art Style: ${style.desc}

Requirements:
- Maintain the exact same subject, pose, and composition
- Apply only the specified art style rendering
- High quality, detailed artwork
- No text or watermarks`;

            let modelEndpoint = '';
            let requestBody = {};
            let requestHeaders = { 'Content-Type': 'application/json' };

            if (selectedModel === 'imagen-4') {
                // Imagen 4 APIï¼ˆä½¿ç”¨ x-goog-api-key headerï¼‰
                modelEndpoint = `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict`;
                requestHeaders['x-goog-api-key'] = apiKey;
                requestBody = {
                    instances: [{ prompt: prompt }],
                    parameters: {
                        sampleCount: 1
                    }
                };
            } else if (selectedModel === 'gemini-2.5-flash') {
                // Gemini 2.5 Flash Preview
                modelEndpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`;
                requestBody = {
                    contents: [{ 
                        parts: [{ text: prompt }] 
                    }],
                    generationConfig: {
                        responseModalities: ["TEXT", "IMAGE"]
                    }
                };
            } else {
                // Gemini 2.0 Flashï¼ˆé è¨­ï¼‰
                modelEndpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${apiKey}`;
                requestBody = {
                    contents: [{ 
                        parts: [{ text: prompt }] 
                    }],
                    generationConfig: {
                        responseModalities: ["TEXT", "IMAGE"]
                    }
                };
            }

            const response = await fetch(modelEndpoint, {
                method: 'POST',
                headers: requestHeaders,
                body: JSON.stringify(requestBody)
            });

            const data = await response.json();

            if (data.error) {
                throw new Error(data.error.message);
            }

            // è§£æåœ–ç‰‡æ•¸æ“š
            if (selectedModel === 'imagen-4') {
                if (data.predictions && data.predictions[0]) {
                    return data.predictions[0].bytesBase64Encoded;
                }
            } else {
                if (data.candidates && data.candidates[0]) {
                    const parts = data.candidates[0].content.parts;
                    for (const part of parts) {
                        if (part.inlineData && part.inlineData.mimeType.startsWith('image/')) {
                            return part.inlineData.data;
                        }
                    }
                }
            }

            throw new Error('æœªèƒ½ç²å–åœ–ç‰‡æ•¸æ“š');
        }

        // ============================================
        // è™•ç†è¼¸å‡ºï¼ˆé€é GAS å¾Œç«¯ï¼‰
        // ============================================
        async function handleOutputs() {
            if (generatedImages.length === 0) return;

            const gasUrl = localStorage.getItem('gasUrl');
            const gasSecret = localStorage.getItem('gasSecret');
            const subject = document.getElementById('subjectInput').value.trim();
            
            const allStyles = [...defaultStyles, ...customStyles];
            const usedStyles = selectedStyles.map(id => allStyles.find(s => s.id === id)).filter(Boolean);

            // æœ¬æ©Ÿä¸‹è¼‰æç¤º
            if (outputOptions.download) {
                addLog('ğŸ’¾ æœ¬æ©Ÿä¸‹è¼‰å·²æº–å‚™å°±ç·’ï¼ˆè«‹è‡³çµæœé ä¸‹è¼‰ï¼‰', 'info');
            }

            // Google ç›¸ç°¿ï¼ˆå‰ç«¯ç›´æ¥ä¸Šå‚³ï¼‰
            if (outputOptions.photos) {
                await uploadToGooglePhotos(usedStyles);
            }

            // å¦‚æœéœ€è¦ GAS æœå‹™ï¼ˆDocã€LINEï¼‰
            const needsGAS = outputOptions.docs || outputOptions.line;
            
            if (needsGAS) {
                if (!gasUrl || !gasSecret) {
                    addLog('âš ï¸ GAS è¨­å®šæœªå®Œæˆï¼Œè·³é Doc/LINE åŠŸèƒ½', 'error');
                    return;
                }

                addLog('â˜ï¸ é–‹å§‹åŸ·è¡Œ GAS æµç¨‹...', 'info');

                try {
                    const payload = {
                        secret: gasSecret,
                        action: 'fullProcess',
                        subject: subject,
                        model: selectedModel,
                        styles: usedStyles.map(s => ({ name: s.name, icon: s.icon })),
                        images: generatedImages.map(img => ({
                            style: img.style,
                            data: img.data
                        })),
                        options: {
                            photos: false,  // ç›¸ç°¿å·²ç”¨å‰ç«¯è™•ç†
                            book: outputOptions.docs,
                            notification: outputOptions.line
                        }
                    };

                    addLog('ğŸ“¤ å‚³é€è³‡æ–™åˆ° GAS...', 'info');
                    
                    const response = await fetch(gasUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'text/plain' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();

                    if (result.success) {
                        addLog('âœ… GAS æµç¨‹å®Œæˆï¼', 'success');
                        
                        if (result.results.book?.success) {
                            addLog(`ğŸ“š å·²å»ºç«‹ã€Œè¶…ç´šæŒ‡ä»¤æ’ç•«åœ–é‘‘ã€`, 'success');
                            addLog(`ğŸ“„ åœ–é‘‘é€£çµ: ${result.results.book.docUrl}`, 'info');
                        }
                        
                        if (result.results.notification?.success) {
                            addLog('ğŸ’¬ LINE é€šçŸ¥å·²ç™¼é€', 'success');
                        }
                    } else {
                        addLog('âš ï¸ GAS æµç¨‹éƒ¨åˆ†å¤±æ•—: ' + result.message, 'error');
                    }

                } catch (error) {
                    console.error('GAS éŒ¯èª¤:', error);
                    addLog('âŒ GAS æµç¨‹å¤±æ•—: ' + error.message, 'error');
                }
            }
        }

        // ============================================
        // Google Photos å‰ç«¯ä¸Šå‚³ï¼ˆOAuth 2.0ï¼‰
        // ============================================
        const GOOGLE_TOKEN_KEY = 'superOrder_googleToken';
        const GOOGLE_SCOPES = 'https://www.googleapis.com/auth/photoslibrary.appendonly https://www.googleapis.com/auth/photoslibrary.readonly';
        let googleTokenClient = null;

        // å–å¾—å·²å„²å­˜çš„ Token
        function getStoredGoogleToken() {
            try {
                const saved = localStorage.getItem(GOOGLE_TOKEN_KEY);
                if (!saved) return null;
                const tokenData = JSON.parse(saved);
                const elapsed = (Date.now() - tokenData.savedAt) / 1000;
                if (elapsed < tokenData.expiresIn - 60) {
                    return tokenData.token;
                }
                return null;
            } catch (e) {
                return null;
            }
        }

        // å„²å­˜ Token
        function saveGoogleToken(token) {
            const tokenData = {
                token: token,
                savedAt: Date.now(),
                expiresIn: token.expires_in || 3600
            };
            localStorage.setItem(GOOGLE_TOKEN_KEY, JSON.stringify(tokenData));
        }

        // åˆå§‹åŒ– Google Token Client
        function initGoogleTokenClient() {
            const clientId = localStorage.getItem('googleClientId');
            if (!clientId) {
                showToast('è«‹å…ˆåœ¨è¨­å®šé è¼¸å…¥ Google Client ID', 'error');
                return false;
            }
            
            if (typeof google === 'undefined' || !google.accounts) {
                showToast('Google API å°šæœªè¼‰å…¥ï¼Œè«‹é‡æ–°æ•´ç†é é¢', 'error');
                return false;
            }
            
            googleTokenClient = google.accounts.oauth2.initTokenClient({
                client_id: clientId,
                scope: GOOGLE_SCOPES,
                callback: (response) => {
                    if (response.error) {
                        showToast('æˆæ¬Šå¤±æ•—: ' + response.error, 'error');
                        return;
                    }
                    saveGoogleToken(response);
                    showToast('âœ… Google ç›¸ç°¿æˆæ¬ŠæˆåŠŸï¼', 'success');
                    showFieldStatus('googleStatus', 'âœ… å·²æˆæ¬Š Google ç›¸ç°¿', 'success');
                }
            });
            return true;
        }

        // Google æˆæ¬Š
        function googleAuth() {
            const token = getStoredGoogleToken();
            if (token) {
                showToast('Google æˆæ¬Šä»ç„¶æœ‰æ•ˆ', 'success');
                return;
            }
            if (!initGoogleTokenClient()) return;
            googleTokenClient.requestAccessToken({ prompt: 'consent' });
        }

        // ä¸Šå‚³åˆ° Google ç›¸ç°¿
        async function uploadToGooglePhotos(usedStyles) {
            const token = getStoredGoogleToken();
            if (!token) {
                addLog('âš ï¸ è«‹å…ˆæˆæ¬Š Google ç›¸ç°¿ï¼ˆè¨­å®šé  â†’ Google OAuth â†’ ğŸ” æˆæ¬Šï¼‰', 'error');
                return;
            }

            const albumName = 'è¶…ç´šæŒ‡ä»¤æ’ç•«åœ–é‘‘';
            addLog('ğŸ“· é–‹å§‹ä¸Šå‚³åˆ° Google ç›¸ç°¿...', 'info');

            try {
                // Step 1: å–å¾—æˆ–å»ºç«‹ç›¸ç°¿
                const albumId = await getOrCreatePhotosAlbum(token.access_token, albumName);
                if (!albumId) {
                    throw new Error('ç„¡æ³•å»ºç«‹ç›¸ç°¿');
                }
                addLog(`ğŸ“ ç›¸ç°¿ï¼š${albumName}`, 'info');

                let uploadCount = 0;

                // Step 2: é€å¼µä¸Šå‚³
                for (let i = 0; i < generatedImages.length; i++) {
                    const img = generatedImages[i];
                    const fileName = `${img.style}_${String(i + 1).padStart(2, '0')}.png`;

                    try {
                        // ä¸Šå‚³åœ–ç‰‡ä½å…ƒçµ„
                        const base64Data = img.data;
                        const binaryString = atob(base64Data);
                        const bytes = new Uint8Array(binaryString.length);
                        for (let j = 0; j < binaryString.length; j++) {
                            bytes[j] = binaryString.charCodeAt(j);
                        }
                        const imageBlob = new Blob([bytes], { type: 'image/png' });

                        const uploadResponse = await fetch('https://photoslibrary.googleapis.com/v1/uploads', {
                            method: 'POST',
                            headers: {
                                'Authorization': 'Bearer ' + token.access_token,
                                'Content-Type': 'application/octet-stream',
                                'X-Goog-Upload-Content-Type': 'image/png',
                                'X-Goog-Upload-Protocol': 'raw'
                            },
                            body: imageBlob
                        });

                        if (!uploadResponse.ok) {
                            throw new Error('ä¸Šå‚³å¤±æ•—');
                        }

                        const uploadToken = await uploadResponse.text();

                        // å»ºç«‹åª’é«”é …ç›®
                        const createResponse = await fetch('https://photoslibrary.googleapis.com/v1/mediaItems:batchCreate', {
                            method: 'POST',
                            headers: {
                                'Authorization': 'Bearer ' + token.access_token,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                albumId: albumId,
                                newMediaItems: [{
                                    description: `${img.style} - è¶…ç´šæŒ‡ä»¤æ’ç•«ç”Ÿæˆå™¨`,
                                    simpleMediaItem: {
                                        fileName: fileName,
                                        uploadToken: uploadToken
                                    }
                                }]
                            })
                        });

                        if (createResponse.ok) {
                            uploadCount++;
                            addLog(`âœ… ${fileName} ä¸Šå‚³æˆåŠŸ`, 'success');
                        }

                    } catch (e) {
                        addLog(`âŒ ${fileName} ä¸Šå‚³å¤±æ•—`, 'error');
                    }

                    // é¿å… rate limit
                    if (i < generatedImages.length - 1) {
                        await sleep(500);
                    }
                }

                const albumUrl = `https://photos.google.com/album/${albumId}`;
                addLog(`ğŸ“· å·²ä¸Šå‚³ ${uploadCount}/${generatedImages.length} å¼µåˆ° Google ç›¸ç°¿`, 'success');
                addLog(`ğŸ”— ç›¸ç°¿é€£çµ: ${albumUrl}`, 'info');

            } catch (error) {
                console.error('Google Photos éŒ¯èª¤:', error);
                if (error.message.includes('401') || error.message.includes('invalid')) {
                    localStorage.removeItem(GOOGLE_TOKEN_KEY);
                    addLog('âŒ Google æˆæ¬Šå·²éæœŸï¼Œè«‹é‡æ–°æˆæ¬Š', 'error');
                } else {
                    addLog('âŒ Google ç›¸ç°¿ä¸Šå‚³å¤±æ•—: ' + error.message, 'error');
                }
            }
        }

        // å–å¾—æˆ–å»ºç«‹ç›¸ç°¿
        async function getOrCreatePhotosAlbum(accessToken, albumName) {
            // æœå°‹ç¾æœ‰ç›¸ç°¿
            try {
                const listResponse = await fetch('https://photoslibrary.googleapis.com/v1/albums?pageSize=50', {
                    headers: { 'Authorization': 'Bearer ' + accessToken }
                });

                if (listResponse.ok) {
                    const listResult = await listResponse.json();
                    const existingAlbum = listResult.albums?.find(a => a.title === albumName);
                    if (existingAlbum) {
                        return existingAlbum.id;
                    }
                }
            } catch (e) {
                console.error('æœå°‹ç›¸ç°¿éŒ¯èª¤:', e);
            }

            // å»ºç«‹æ–°ç›¸ç°¿
            try {
                const createResponse = await fetch('https://photoslibrary.googleapis.com/v1/albums', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + accessToken,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        album: { title: albumName }
                    })
                });

                if (createResponse.ok) {
                    const createResult = await createResponse.json();
                    return createResult.id;
                }
            } catch (e) {
                console.error('å»ºç«‹ç›¸ç°¿éŒ¯èª¤:', e);
            }

            return null;
        }

        // ============================================
        // å–æ¶ˆç”Ÿæˆ
        // ============================================
        function cancelGeneration() {
            cancelFlag = true;
            showToast('æ­£åœ¨å–æ¶ˆ...', 'info');
        }

        // ============================================
        // çµæœé 
        // ============================================
        function renderResults() {
            const grid = document.getElementById('resultsGrid');
            document.getElementById('resultsSubtitle').textContent = `å…± ${generatedImages.length} å¼µåœ–ç‰‡`;

            if (generatedImages.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column:span 2;text-align:center;padding:40px;color:var(--text-muted);">
                        å°šç„¡ç”Ÿæˆçµæœ
                    </div>
                `;
                return;
            }

            grid.innerHTML = generatedImages.map((img, index) => `
                <div class="result-item">
                    <img class="result-image" src="data:image/png;base64,${img.data}" alt="${img.style}">
                    <div class="result-info">
                        <div class="result-style">${img.style}</div>
                        <div class="result-actions">
                            <button class="result-btn" onclick="downloadImage(${index})" title="ä¸‹è¼‰">ğŸ’¾</button>
                            <button class="result-btn" onclick="viewImage(${index})" title="æª¢è¦–">ğŸ”</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function downloadImage(index) {
            const img = generatedImages[index];
            const link = document.createElement('a');
            link.href = 'data:image/png;base64,' + img.data;
            link.download = `illustration_${img.styleId}_${index + 1}.png`;
            link.click();
            showToast('ğŸ“¥ åœ–ç‰‡å·²ä¸‹è¼‰', 'success');
        }

        function downloadAllImages() {
            if (generatedImages.length === 0) {
                showToast('æ²’æœ‰å¯ä¸‹è¼‰çš„åœ–ç‰‡', 'error');
                return;
            }

            generatedImages.forEach((img, index) => {
                setTimeout(() => {
                    const link = document.createElement('a');
                    link.href = 'data:image/png;base64,' + img.data;
                    link.download = `illustration_${img.styleId}_${index + 1}.png`;
                    link.click();
                }, index * 500);
            });

            showToast(`ğŸ“¥ æ­£åœ¨ä¸‹è¼‰ ${generatedImages.length} å¼µåœ–ç‰‡...`, 'success');
        }

        function viewImage(index) {
            const img = generatedImages[index];
            const lightbox = document.getElementById('imageLightbox');
            const lightboxImg = document.getElementById('lightboxImage');
            const lightboxTitle = document.getElementById('lightboxTitle');
            
            lightboxImg.src = `data:image/png;base64,${img.data}`;
            lightboxTitle.textContent = img.style;
            lightbox.classList.add('show');
        }

        function closeLightbox() {
            document.getElementById('imageLightbox').classList.remove('show');
        }

        function clearResults() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰çµæœå—ï¼Ÿ')) {
                generatedImages = [];
                renderResults();
                showToast('å·²æ¸…é™¤çµæœ', 'success');
            }
        }

        // ============================================
        // è‡ªè¨‚é¢¨æ ¼
        // ============================================
        function showCustomStyleModal() {
            renderCustomStyleList();
            document.getElementById('customStyleModal').classList.add('show');
        }

        function renderCustomStyleList() {
            const list = document.getElementById('customStyleList');
            if (customStyles.length === 0) {
                list.innerHTML = '<div style="text-align:center;color:var(--text-muted);padding:20px;">å°šç„¡è‡ªè¨‚é¢¨æ ¼</div>';
                return;
            }

            list.innerHTML = customStyles.map((style, index) => `
                <div class="custom-style-item">
                    <span class="style-icon">${style.icon}</span>
                    <span class="style-text">${style.name}</span>
                    <button class="delete-btn" onclick="deleteCustomStyle(${index})">âœ•</button>
                </div>
            `).join('');
        }

        function selectIcon(icon) {
            selectedIcon = icon;
            document.querySelectorAll('.style-icon-option').forEach(el => {
                el.classList.toggle('selected', el.textContent === icon);
            });
        }

        function addCustomStyle() {
            const name = document.getElementById('customStyleName').value.trim();
            const desc = document.getElementById('customStyleDesc').value.trim();

            if (!name || !desc) {
                showToast('è«‹å¡«å¯«é¢¨æ ¼åç¨±å’Œæè¿°', 'error');
                return;
            }

            const newStyle = {
                id: 'custom-' + Date.now(),
                name: name,
                icon: selectedIcon,
                desc: desc,
                custom: true
            };

            customStyles.push(newStyle);
            saveCustomStyles();
            
            document.getElementById('customStyleName').value = '';
            document.getElementById('customStyleDesc').value = '';
            
            renderCustomStyleList();
            renderStyleGrid();
            
            showToast('âœ… è‡ªè¨‚é¢¨æ ¼å·²æ–°å¢', 'success');
        }

        function deleteCustomStyle(index) {
            const style = customStyles[index];
            // å¾é¸æ“‡ä¸­ç§»é™¤
            const selectedIndex = selectedStyles.indexOf(style.id);
            if (selectedIndex > -1) {
                selectedStyles.splice(selectedIndex, 1);
            }
            
            customStyles.splice(index, 1);
            saveCustomStyles();
            renderCustomStyleList();
            renderStyleGrid();
            showToast('å·²åˆªé™¤è‡ªè¨‚é¢¨æ ¼', 'success');
        }

        // ============================================
        // è¨­å®šå„²å­˜èˆ‡ç®¡ç†
        // ============================================
        
        // åˆ‡æ›å¯†ç¢¼é¡¯ç¤º/éš±è—
        function toggleVisibility(inputId, btn) {
            const input = document.getElementById(inputId);
            if (input.type === 'password') {
                input.type = 'text';
                btn.textContent = 'ğŸ”’';
                btn.classList.add('active');
            } else {
                input.type = 'password';
                btn.textContent = 'ğŸ‘ï¸';
                btn.classList.remove('active');
            }
        }

        // é¡¯ç¤ºæ¬„ä½ç‹€æ…‹
        function showFieldStatus(statusId, message, type = 'info') {
            const status = document.getElementById(statusId);
            status.textContent = message;
            status.className = 'field-status show ' + type;
            
            // 3 ç§’å¾Œè‡ªå‹•éš±è—ï¼ˆé™¤äº† errorï¼‰
            if (type !== 'error') {
                setTimeout(() => {
                    status.classList.remove('show');
                }, 3000);
            }
        }

        // å„²å­˜å–®ä¸€æ¬„ä½
        function saveField(fieldType) {
            switch (fieldType) {
                case 'apiKey':
                    const apiKey = document.getElementById('apiKeyInput').value.trim();
                    if (!apiKey) {
                        showFieldStatus('apiKeyStatus', 'âŒ è«‹è¼¸å…¥ API Key', 'error');
                        return;
                    }
                    localStorage.setItem('geminiApiKey', apiKey);
                    showFieldStatus('apiKeyStatus', 'âœ… API Key å·²å„²å­˜', 'success');
                    break;
                    
                case 'gas':
                    const gasUrl = document.getElementById('gasUrlInput').value.trim();
                    const gasSecret = document.getElementById('gasSecretInput').value.trim();
                    if (!gasUrl || !gasSecret) {
                        showFieldStatus('gasStatus', 'âŒ è«‹å¡«å¯« URL å’Œå®‰å…¨å¯†é‘°', 'error');
                        return;
                    }
                    localStorage.setItem('gasUrl', gasUrl);
                    localStorage.setItem('gasSecret', gasSecret);
                    showFieldStatus('gasStatus', 'âœ… GAS è¨­å®šå·²å„²å­˜', 'success');
                    break;
                    
                case 'google':
                    const clientId = document.getElementById('googleClientId').value.trim();
                    if (!clientId) {
                        showFieldStatus('googleStatus', 'âŒ è«‹è¼¸å…¥ Client ID', 'error');
                        return;
                    }
                    localStorage.setItem('googleClientId', clientId);
                    showFieldStatus('googleStatus', 'âœ… Google OAuth å·²å„²å­˜', 'success');
                    break;
            }
        }

        // æ¸…é™¤å–®ä¸€æ¬„ä½
        function clearField(fieldType) {
            switch (fieldType) {
                case 'apiKey':
                    if (!confirm('ç¢ºå®šè¦æ¸…é™¤ API Key å—ï¼Ÿ')) return;
                    localStorage.removeItem('geminiApiKey');
                    document.getElementById('apiKeyInput').value = '';
                    showFieldStatus('apiKeyStatus', 'ğŸ—‘ï¸ API Key å·²æ¸…é™¤', 'warning');
                    break;
                    
                case 'gas':
                    if (!confirm('ç¢ºå®šè¦æ¸…é™¤ GAS è¨­å®šå—ï¼Ÿ')) return;
                    localStorage.removeItem('gasUrl');
                    localStorage.removeItem('gasSecret');
                    document.getElementById('gasUrlInput').value = '';
                    document.getElementById('gasSecretInput').value = '';
                    showFieldStatus('gasStatus', 'ğŸ—‘ï¸ GAS è¨­å®šå·²æ¸…é™¤', 'warning');
                    break;
                    
                case 'google':
                    if (!confirm('ç¢ºå®šè¦æ¸…é™¤ Google OAuth å—ï¼Ÿ')) return;
                    localStorage.removeItem('googleClientId');
                    document.getElementById('googleClientId').value = '';
                    showFieldStatus('googleStatus', 'ğŸ—‘ï¸ Google OAuth å·²æ¸…é™¤', 'warning');
                    break;
            }
        }

        // æ¸¬è©¦ GAS é€£ç·š
        async function testGasConnection() {
            const gasUrl = localStorage.getItem('gasUrl');
            const gasSecret = localStorage.getItem('gasSecret');
            
            if (!gasUrl || !gasSecret) {
                showFieldStatus('gasStatus', 'âŒ è«‹å…ˆå„²å­˜ GAS è¨­å®š', 'error');
                return;
            }
            
            showFieldStatus('gasStatus', 'ğŸ”„ æ¸¬è©¦é€£ç·šä¸­...', 'info');
            
            try {
                const response = await fetch(gasUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        secret: gasSecret,
                        action: 'test'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showFieldStatus('gasStatus', 'âœ… GAS é€£ç·šæˆåŠŸï¼ç›¸ç°¿ï¼š' + (result.config?.albumName || 'å·²è¨­å®š'), 'success');
                } else {
                    showFieldStatus('gasStatus', 'âŒ é€£ç·šå¤±æ•—ï¼š' + result.error, 'error');
                }
            } catch (error) {
                showFieldStatus('gasStatus', 'âŒ é€£ç·šéŒ¯èª¤ï¼š' + error.message, 'error');
            }
        }

        // æ¸¬è©¦ LINE é€šçŸ¥
        async function testLineNotification() {
            const gasUrl = localStorage.getItem('gasUrl');
            const gasSecret = localStorage.getItem('gasSecret');
            
            if (!gasUrl || !gasSecret) {
                showFieldStatus('lineStatus', 'âŒ è«‹å…ˆè¨­å®š GAS å¾Œç«¯', 'error');
                return;
            }
            
            showFieldStatus('lineStatus', 'ğŸ“¨ ç™¼é€æ¸¬è©¦é€šçŸ¥...', 'info');
            
            try {
                const response = await fetch(gasUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: JSON.stringify({
                        secret: gasSecret,
                        action: 'sendNotification',
                        message: `ğŸ¨ è¶…ç´šæŒ‡ä»¤æ’ç•«ç”Ÿæˆå™¨\n\nğŸ“¨ æ¸¬è©¦é€šçŸ¥\né€™æ˜¯ä¸€å‰‡æ¸¬è©¦è¨Šæ¯ï¼Œå¦‚æœä½ æ”¶åˆ°è¡¨ç¤º LINE é€šçŸ¥åŠŸèƒ½æ­£å¸¸ï¼\n\nâ° ${new Date().toLocaleString('zh-TW')}`
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showFieldStatus('lineStatus', 'âœ… æ¸¬è©¦é€šçŸ¥å·²ç™¼é€ï¼Œè«‹æª¢æŸ¥ LINE', 'success');
                } else {
                    showFieldStatus('lineStatus', 'âŒ ç™¼é€å¤±æ•—ï¼š' + result.error, 'error');
                }
            } catch (error) {
                showFieldStatus('lineStatus', 'âŒ ç™¼é€éŒ¯èª¤ï¼š' + error.message, 'error');
            }
        }

        // åŒ¯å‡ºæ‰€æœ‰è¨­å®š
        function exportSettings() {
            const settings = {
                geminiApiKey: localStorage.getItem('geminiApiKey') || '',
                gasUrl: localStorage.getItem('gasUrl') || '',
                gasSecret: localStorage.getItem('gasSecret') || '',
                googleClientId: localStorage.getItem('googleClientId') || '',
                customStyles: localStorage.getItem('customStyles') || '[]',
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(settings, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `è¶…ç´šæŒ‡ä»¤æ’ç•«ç”Ÿæˆå™¨_è¨­å®š_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showToast('ğŸ“¤ è¨­å®šå·²åŒ¯å‡º', 'success');
        }

        // åŒ¯å…¥è¨­å®š
        function importSettings() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                try {
                    const text = await file.text();
                    const settings = JSON.parse(text);
                    
                    if (settings.geminiApiKey) localStorage.setItem('geminiApiKey', settings.geminiApiKey);
                    if (settings.gasUrl) localStorage.setItem('gasUrl', settings.gasUrl);
                    if (settings.gasSecret) localStorage.setItem('gasSecret', settings.gasSecret);
                    if (settings.googleClientId) localStorage.setItem('googleClientId', settings.googleClientId);
                    if (settings.customStyles) localStorage.setItem('customStyles', settings.customStyles);
                    
                    loadSettings();
                    showToast('ğŸ“¥ è¨­å®šå·²åŒ¯å…¥', 'success');
                } catch (error) {
                    showToast('âŒ åŒ¯å…¥å¤±æ•—ï¼šæª”æ¡ˆæ ¼å¼éŒ¯èª¤', 'error');
                }
            };
            input.click();
        }

        // æ¸…é™¤æ‰€æœ‰è¨­å®š
        function clearAllSettings() {
            if (!confirm('âš ï¸ ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è³‡æ–™å—ï¼Ÿ\n\né€™å°‡åˆªé™¤ï¼š\nâ€¢ API Key\nâ€¢ GAS è¨­å®š\nâ€¢ Google OAuth\nâ€¢ è‡ªè¨‚é¢¨æ ¼\nâ€¢ ç”Ÿæˆçµæœ\n\næ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) return;
            
            localStorage.clear();
            generatedImages = [];
            customStyles = [];
            selectedStyles = [];
            
            // é‡æ–°è¼‰å…¥é é¢
            location.reload();
        }

        function loadSettings() {
            // API Key
            const apiKey = localStorage.getItem('geminiApiKey');
            if (apiKey) {
                document.getElementById('apiKeyInput').value = apiKey;
                showFieldStatus('apiKeyStatus', 'âœ… å·²è¼‰å…¥ API Key', 'success');
            }

            // GAS è¨­å®š
            const gasUrl = localStorage.getItem('gasUrl');
            const gasSecret = localStorage.getItem('gasSecret');
            if (gasUrl) document.getElementById('gasUrlInput').value = gasUrl;
            if (gasSecret) document.getElementById('gasSecretInput').value = gasSecret;
            if (gasUrl && gasSecret) {
                showFieldStatus('gasStatus', 'âœ… å·²è¼‰å…¥ GAS è¨­å®š', 'success');
            }

            // Google Client ID
            const clientId = localStorage.getItem('googleClientId');
            if (clientId) {
                document.getElementById('googleClientId').value = clientId;
                showFieldStatus('googleStatus', 'âœ… å·²è¼‰å…¥ Google OAuth', 'success');
            }

            // è‡ªè¨‚é¢¨æ ¼
            const stored = localStorage.getItem('customStyles');
            if (stored) {
                customStyles = JSON.parse(stored);
            }
        }

        // èˆŠå‡½æ•¸ä¿ç•™ç›¸å®¹æ€§
        function saveApiKey() { saveField('apiKey'); }
        function saveLineSettings() { saveField('gas'); }
        
        function saveCustomStyles() {
            localStorage.setItem('customStyles', JSON.stringify(customStyles));
        }

        // ============================================
        // å·¥å…·å‡½æ•¸
        // ============================================
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show ' + type;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function showHelpModal() {
            document.getElementById('helpModal').classList.add('show');
        }

        function addLog(message, type = 'info') {
            const log = document.getElementById('progressLog');
            const time = new Date().toLocaleTimeString('zh-TW');
            log.innerHTML += `<div class="log-item ${type}">[${time}] ${message}</div>`;
            log.scrollTop = log.scrollHeight;
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Modal é»æ“Šå¤–éƒ¨é—œé–‰
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('show');
                }
            });
        });
    </script>
</body>
</html>
